<app-page-title [title]="title" [breadcrumbItems]="breadcrumbItems"></app-page-title>

<div *ngIf="loading" class="mb-3">Chargement...</div>
<div *ngIf="error" class="alert alert-danger mb-3">{{ error }}</div>

<div *ngIf="settings" class="card p-3 mb-3">

  <!-- Cible de réclamation (nombre) -->
  <label for="reclamationTarget-{{ settings.id }}" class="form-label">Cible de réclamation par projet</label>
  <input
    id="reclamationTarget-{{ settings.id }}"
    type="number"
    class="form-control mb-4"
    [value]="settings.reclamationTarget"
    (input)="onNumberFieldChange('reclamationTarget', $event)"
  />

  <!-- Boucle sur les listes d'emails -->
  <ng-container *ngFor="let field of emailFields">
    <div class="mb-4">
      <label class="form-label text-capitalize">
        {{ formatFieldLabel(field) }}
      </label>

      <ul class="list-group mb-2">
        <li
          *ngFor="let email of settings[field]"
          class="list-group-item d-flex justify-content-between align-items-center"
        >
          {{ email }}
          <button
            type="button"
            class="btn btn-sm btn-danger"
            (click)="removeEmail(field, email)"
          >
            Supprimer
          </button>
        </li>
        <li *ngIf="!settings[field] || settings[field].length === 0" class="list-group-item text-muted">
          Aucun email dans cette liste.
        </li>
      </ul>

      <button
        *ngIf="addingEmailField !== field"
        type="button"
        class="btn btn-outline-primary btn-sm"
        (click)="startAddingEmail(field)"
      >
        Ajouter un email
      </button>

      <div *ngIf="addingEmailField === field" class="input-group mt-2">
        <input
          #emailInput
          type="email"
          class="form-control"
          placeholder="Nouvel email"
          [(ngModel)]="newEmailValue"
          required
        />
        <button class="btn btn-success" type="button" (click)="addEmail(field, emailInput)">Envoyer</button>
        <button class="btn btn-secondary" type="button" (click)="cancelAddingEmail()">Annuler</button>
      </div>
    </div>
  </ng-container>
</div>
