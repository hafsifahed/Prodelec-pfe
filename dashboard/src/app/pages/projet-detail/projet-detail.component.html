<div class="container py-4" *ngIf="project">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg">
        <div class="card-header bg-primary text-white">
          <h2 class="mb-0">Détail du projet : {{ project.refProdelec }}</h2>
        </div>
        <div class="card-body">

          <!-- Informations générales -->
          <ul class="list-group list-group-flush mb-4">
            <li class="list-group-item"><strong>Client :</strong> {{ project.order?.user?.username }}</li>
            <li class="list-group-item"><strong>Date Réception BC :</strong> {{ project.order?.createdAt | date:'yyyy-MM-dd' }}</li>
            <li class="list-group-item"><strong>N° BC :</strong> {{ project.order?.orderName }}</li>
            <li class="list-group-item"><strong>Réf. Client :</strong> {{ project.refClient }} - {{project.order.user.partner.name}}</li>
            <li class="list-group-item"><strong>Quantité :</strong> {{ project.qte }}</li>
            <li class="list-group-item">
              <strong>Date de livraison prévue :</strong> 
              <span [ngClass]="{'text-danger': isDateOverdue(project.dlp,project)}">
                {{ project.dlp | date:'yyyy-MM-dd' }}
              </span>
            </li>
            <li class="list-group-item"><strong>Durée :</strong> {{ project.duree }} heures</li>
            <li class="list-group-item"><strong>Date de création :</strong> {{ project.createdAt | date:'yyyy-MM-dd HH:mm' }}</li>
            <li class="list-group-item"><strong>Date de mise à jour :</strong> {{ project.updatedAt | date:'yyyy-MM-dd HH:mm' }}</li>
          </ul>

          <!-- Progressions détaillées -->
          <div class="row gy-3 mb-4">

            <!-- Fonction pour afficher chaque étape -->
            <ng-container *ngFor="let step of ['conception', 'methode', 'production', 'finalControl', 'delivery']">
              <div class="col-md-6" [ngSwitch]="step">

                <!-- Conception -->
                <div *ngSwitchCase="'conception'">
                  <div class="mb-2 d-flex align-items-center justify-content-between">
                    <span>
                      <span *ngIf="project.conceptionprogress > 0" class="badge" [ngClass]="project.conceptionStatus ? 'bg-success' : 'bg-danger'">
                        {{ project.conceptionStatus ? 'Conception : Terminé' : 'Conception : En cours' }}
                      </span>
                      <span *ngIf="isDateOverdue1(project.endConception, project.realendConception)" class="badge bg-warning ms-2">En retard</span>
                    </span>
                    <span>{{ project.conceptionprogress.toFixed(2) }}%</span>
                  </div>
                  <div class="progress mb-1" style="height: 20px;">
                    <div class="progress-bar bg-info" role="progressbar" [style.width]="project.conceptionprogress + '%'" aria-valuenow="{{project.conceptionprogress}}" aria-valuemin="0" aria-valuemax="100">
                      {{ project.conceptionprogress.toFixed(2) }}%
                    </div>
                  </div>
                  <input *ngIf="(userr && project.conceptionResponsible && project.conceptionResponsible.id === userr.id) || userr.role?.name === 'SUBADMIN'"
                         type="range" min="0" max="100" [value]="project.conceptionprogress"
                         (input)="updateConceptionProgress(project, $event)" class="form-range" aria-label="Progression conception" />
                  <div class="d-flex justify-content-center">
                    <button class="btn detail-custom" (click)="openDetailsconsModal(project)">
                      <i class="bx bxs-detail" style="font-size: medium;"></i>
                    </button>
                  </div>
                </div>

                <!-- Méthode -->
                <div *ngSwitchCase="'methode'">
                  <div class="mb-2 d-flex align-items-center justify-content-between">
                    <span>
                      <span *ngIf="project.methodeprogress > 0" class="badge" [ngClass]="project.methodeStatus ? 'bg-success' : 'bg-danger'">
                        {{ project.methodeStatus ? 'Méthode : Terminé' : 'Méthode : En cours' }}
                      </span>
                      <span *ngIf="isDateOverdue1(project.endMethode, project.realendMethode)" class="badge bg-warning ms-2">En retard</span>
                    </span>
                    <span>{{ project.methodeprogress.toFixed(2) }}%</span>
                  </div>
                  <div class="progress mb-1" style="height: 20px;">
                    <div class="progress-bar bg-info" role="progressbar" [style.width]="project.methodeprogress + '%'" aria-valuenow="{{project.methodeprogress}}" aria-valuemin="0" aria-valuemax="100">
                      {{ project.methodeprogress.toFixed(2) }}%
                    </div>
                  </div>
                  <input *ngIf="(userr && project.methodeResponsible && userr.id === project.methodeResponsible.id) || userr.role?.name === 'SUBADMIN'"
                         type="range" min="0" max="100" [value]="project.methodeprogress"
                         (input)="updatemProgress(project, $event)" class="form-range" aria-label="Progression méthode" />
                  <div class="d-flex justify-content-center">
                    <button class="btn detail-custom" (click)="openDetailsmetModal(project)">
                      <i class="bx bxs-detail" style="font-size: medium;"></i>
                    </button>
                  </div>
                </div>

                <!-- Production -->
                <div *ngSwitchCase="'production'">
                  <div class="mb-2 d-flex align-items-center justify-content-between">
                    <span>
                      <span *ngIf="project.productionprogress > 0" class="badge" [ngClass]="project.productionStatus ? 'bg-success' : 'bg-danger'">
                        {{ project.productionStatus ? 'Production : Terminé' : 'Production : En cours' }}
                      </span>
                      <span *ngIf="isDateOverdue1(project.endProduction, project.realendProduction)" class="badge bg-warning ms-2">En retard</span>
                    </span>
                    <span>{{ project.productionprogress.toFixed(2) }}%</span>
                  </div>
                  <div class="progress mb-1" style="height: 20px;">
                    <div class="progress-bar bg-info" role="progressbar" [style.width]="project.productionprogress + '%'" aria-valuenow="{{project.productionprogress}}" aria-valuemin="0" aria-valuemax="100">
                      {{ project.productionprogress.toFixed(2) }}%
                    </div>
                  </div>
                  <input *ngIf="(userr && project.productionResponsible && userr.id === project.productionResponsible.id) || userr.role?.name === 'SUBADMIN'"
                         type="range" min="0" max="100" [value]="project.productionprogress"
                         (input)="updatepProgress(project, $event)" class="form-range" aria-label="Progression production" />
                  <div class="d-flex justify-content-center">
                    <button class="btn detail-custom" (click)="openDetailsprodModal(project)">
                      <i class="bx bxs-detail" style="font-size: medium;"></i>
                    </button>
                  </div>
                </div>

                <!-- Contrôle final -->
                <div *ngSwitchCase="'finalControl'">
                  <div class="mb-2 d-flex align-items-center justify-content-between">
                    <span>
                      <span *ngIf="project.fcprogress > 0" class="badge" [ngClass]="project.finalControlStatus ? 'bg-success' : 'bg-danger'">
                        {{ project.finalControlStatus ? 'Contrôle final : Terminé' : 'Contrôle final : En cours' }}
                      </span>
                      <span *ngIf="isDateOverdue1(project.endFc, project.realendFc)" class="badge bg-warning ms-2">En retard</span>
                    </span>
                    <span>{{ project.fcprogress.toFixed(2) }}%</span>
                  </div>
                  <div class="progress mb-1" style="height: 20px;">
                    <div class="progress-bar bg-info" role="progressbar" [style.width]="project.fcprogress + '%'" aria-valuenow="{{project.fcprogress}}" aria-valuemin="0" aria-valuemax="100">
                      {{ project.fcprogress.toFixed(2) }}%
                    </div>
                  </div>
                  <input *ngIf="(userr && project.finalControlResponsible && userr.id === project.finalControlResponsible.id) || userr.role?.name === 'SUBADMIN'"
                         type="range" min="0" max="100" [value]="project.fcprogress"
                         (input)="updatefcProgress(project, $event)" class="form-range" aria-label="Progression contrôle final" />
                  <div class="d-flex justify-content-center">
                    <button class="btn detail-custom" (click)="openDetailsfcModal(project)">
                      <i class="bx bxs-detail" style="font-size: medium;"></i>
                    </button>
                  </div>
                </div>

                <!-- Livraison -->
                <div *ngSwitchCase="'delivery'">
                  <div class="mb-2 d-flex align-items-center justify-content-between">
                    <span>
                      <span *ngIf="project.deliveryprogress > 0" class="badge" [ngClass]="project.deliveryStatus ? 'bg-success' : 'bg-danger'">
                        {{ project.deliveryStatus ? 'Livraison : Terminé' : 'Livraison : En cours' }}
                      </span>
                      <span *ngIf="isDateOverdue1(project.endDelivery, project.realendDelivery)" class="badge bg-warning ms-2">En retard</span>
                    </span>
                    <span>{{ project.deliveryprogress.toFixed(2) }}%</span>
                  </div>
                  <div class="progress mb-1" style="height: 20px;">
                    <div class="progress-bar bg-info" role="progressbar" [style.width]="project.deliveryprogress + '%'" aria-valuenow="{{project.deliveryprogress}}" aria-valuemin="0" aria-valuemax="100">
                      {{ project.deliveryprogress.toFixed(2) }}%
                    </div>
                  </div>
                  <input *ngIf="(userr && project.deliveryResponsible && userr.id === project.deliveryResponsible.id) || userr.role?.name === 'SUBADMIN'"
                         type="range" min="0" max="100" [value]="project.deliveryprogress"
                         (input)="updatedProgress(project, $event)" class="form-range" aria-label="Progression livraison" />
                  <div class="d-flex justify-content-center">
                    <button class="btn detail-custom" (click)="openDetailsdelModal(project)">
                      <i class="bx bxs-detail" style="font-size: medium;"></i>
                    </button>
                  </div>
                </div>

              </div>
            </ng-container>

            <!-- Progression totale -->
            <div class="col-md-6">
              <div class="mb-2 d-flex align-items-center justify-content-between">
                <span class="fw-bold">Progression totale</span>
                <span>{{ project.progress.toFixed(2) }}%</span>
              </div>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar bg-primary" role="progressbar" [style.width]="project.progress + '%'" aria-valuenow="{{project.progress}}" aria-valuemin="0" aria-valuemax="100">
                  {{ project.progress.toFixed(2) }}%
                </div>
              </div>
            </div>

          </div>

          <!-- Actions -->
          <div class="d-flex flex-wrap gap-2 mt-4">
            <button class="btn btn-primary" (click)="editModal(project.idproject)">
              <i class="mdi mdi-pencil"></i> Modifier
            </button>
            <button class="btn btn-danger" (click)="delete(project.idproject)">
              <i class="mdi mdi-delete"></i> Supprimer
            </button>
            <button class="btn btn-warning" (click)="archive(project.idproject)">
              <i class="mdi mdi-archive"></i> Archiver
            </button>
            <button class="btn btn-success" (click)="addModal(project)">
              <i class="mdi mdi-plus"></i> Dupliquer
            </button>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>



<!------------------------------ajouter dup----------------------------------------------------------------------->

<div bsModal #showModala="bs-modal" class="modal fade" id="showModala" tabindex="-1" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Ajouter projet</h5>
        <button type="button" class="btn-close" (click)="showModala.hide()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="projectsForm" (ngSubmit)="addproject()" novalidate>
          <div class="row g-3">

            <!-- Champs généraux -->
            <div class="col-12 col-lg-6">
              <label class="form-label">Quantité</label>
              <input type="number" class="form-control" formControlName="qte" required />
            </div>
            <div class="col-12 col-lg-6">
              <label class="form-label">Date de livraison prévue</label>
              <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dlp" />
            </div>

            <!-- Boutons d'affichage des sections -->
            <div class="col-12">
              <div class="d-flex flex-wrap gap-2 mb-3">
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('add', 'conception')">
                  {{ showConceptionAdd ? 'Masquer Conception' : 'Afficher Conception' }}
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('add', 'methode')">
                  {{ showMethodeAdd ? 'Masquer Méthode' : 'Afficher Méthode' }}
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('add', 'production')">
                  {{ showProductionAdd ? 'Masquer Production' : 'Afficher Production' }}
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('add', 'controle')">
                  {{ showControleAdd ? 'Masquer Contrôle finale' : 'Afficher Contrôle finale' }}
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('add', 'livraison')">
                  {{ showLivraisonAdd ? 'Masquer Livraison' : 'Afficher Livraison' }}
                </button>
              </div>
            </div>

            <!-- Section Conception -->
            <div class="col-12" *ngIf="showConceptionAdd">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">Conception</div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drc" />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rc">
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdc" rows="1"></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dc" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fc" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Méthode -->
            <div class="col-12" *ngIf="showMethodeAdd">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">Méthode</div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drm" />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rm">
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdm" rows="1"></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dm" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fm" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Production -->
            <div class="col-12" *ngIf="showProductionAdd">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">Production</div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drp" />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rp">
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdp" rows="1"></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dp" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fp" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Contrôle finale -->
            <div class="col-12" *ngIf="showControleAdd">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">Contrôle finale</div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drcf" />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rcf">
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdcf" rows="1"></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dcf" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fcf" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Livraison -->
            <div class="col-12" *ngIf="showLivraisonAdd">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">Livraison</div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drl" />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rl">
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdl" rows="1"></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input type="date" class="form-control" placeholder="yyyy-mm-dd" formControlName="dl" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input type="date" class="form-control" placeholder="yyyy-mm-dd" formControlName="fl" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Boutons -->
            <div class="col-12 text-end">
              <button type="button" class="btn btn-outline-secondary me-2" (click)="showModala.hide()">Annuler</button>
              <button type="submit" class="btn btn-success">Ajouter</button>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!------------------edit--------------modal-lg------xl--------------------------->
<div bsModal #showModal="bs-modal" class="modal fade" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modifier projet</h5>
        <button type="button" class="btn-close" id="close-modal" (click)="showModal.hide()"></button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateproject()" [formGroup]="projectForm" class="needs-validation createorder-form"
          id="createorder-form" novalidate>
          
          <!-- Boutons d'affichage des sections -->
          <div class="mb-3 d-flex flex-wrap gap-2">
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('edit', 'conception')">
              {{ showConceptionEdit ? 'Masquer Conception' : 'Afficher Conception' }}
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('edit', 'methode')">
              {{ showMethodeEdit ? 'Masquer Méthode' : 'Afficher Méthode' }}
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('edit', 'production')">
              {{ showProductionEdit ? 'Masquer Production' : 'Afficher Production' }}
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('edit', 'controle')">
              {{ showControleEdit ? 'Masquer Contrôle finale' : 'Afficher Contrôle finale' }}
            </button>
            <button type="button" class="btn btn-outline-primary btn-sm" (click)="toggleSection('edit', 'livraison')">
              {{ showLivraisonEdit ? 'Masquer Livraison' : 'Afficher Livraison' }}
            </button>
          </div>

          <div class="row g-4">

            <!-- Informations générales -->
            <div class="col-12">
              <input type="hidden" class="form-control" id="orderid-input" />
              <div class="row g-3">
                <div class="col-lg-3 col-md-6">
                  <label for="refc-field" class="form-label">Ref Client</label>
                  <input type="text" id="refc-field" class="form-control" required formControlName="refc" />
                </div>
                <div class="col-lg-3 col-md-6">
                  <label for="refp-field" class="form-label">Ref Prodelec</label>
                  <input type="text" id="refp-field" class="form-control" required formControlName="refp" />
                </div>
                <div class="col-lg-3 col-md-6">
                  <label for="qte-field" class="form-label">Quantité</label>
                  <input type="number" id="qte-field" class="form-control" required formControlName="qte" />
                </div>
                <div class="col-lg-3 col-md-6">
                  <label for="dlp-field" class="form-label">Date de livraison prévue</label>
                  <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dlp" />
                </div>
              </div>
            </div>

            <!-- Section Conception -->
            <div class="col-12" *ngIf="showConceptionEdit">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">
                  Conception
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drc" required />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rc" required>
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdc" rows="1" required></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dc" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fc" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Méthode -->
            <div class="col-12" *ngIf="showMethodeEdit">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">
                  Méthode
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drm" required />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rm" required>
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdm" rows="1" required></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dm" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fm" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Production -->
            <div class="col-12" *ngIf="showProductionEdit">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">
                  Production
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drp" required />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rp" required>
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdp" rows="1" required></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dp" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fp" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Contrôle finale -->
            <div class="col-12" *ngIf="showControleEdit">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">
                  Contrôle finale
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drcf" required />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rcf" required>
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdcf" rows="1" required></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="dcf" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input bsDatepicker class="form-control" placeholder="yyyy-mm-dd" formControlName="fcf" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section Livraison -->
            <div class="col-12" *ngIf="showLivraisonEdit">
              <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-semibold">
                  Livraison
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Durée</label>
                      <input type="number" class="form-control" formControlName="drl" required />
                    </div>
                    <div class="col-lg-4 col-md-6">
                      <label class="form-label">Pilote</label>
                      <select class="form-select" formControlName="rl" required>
                        <option value="">Sélectionner</option>
                        <option *ngFor="let dt of listr" [value]="dt.username">{{ dt.username }}</option>
                      </select>
                    </div>
                    <div class="col-lg-4 col-md-12">
                      <label class="form-label">Commentaire</label>
                      <textarea class="form-control" formControlName="cdl" rows="1" required></textarea>
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Début</label>
                      <input type="date" class="form-control" placeholder="yyyy-mm-dd" formControlName="dl" />
                    </div>
                    <div class="col-lg-6 col-md-6">
                      <label class="form-label">Fin</label>
                      <input type="date" class="form-control" placeholder="yyyy-mm-dd" formControlName="fl" />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Boutons -->
            <div class="col-12 text-end">
              <button type="button" class="btn btn-outline-secondary me-2" (click)="showModal.hide()">Annuler</button>
              <button type="submit" class="btn btn-success">Modifier</button>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
</div>



<!------------------------------------------------------------------------------------------------------->

<ng-template #detailsconModal>

  <div class="modal-header">
    <h5 class="modal-title">Détails</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body modal-body-centered">
    <p class="mb-1" 
              *ngIf="project?.conceptionResponsible?.username">{{ project.conceptionComment }}</p>
            <p class="mb-1">Durée: {{project.conceptionDuration }} heures</p>
            <p class="mb-0" *ngIf="project?.conceptionResponsible?.username">Pilote: {{ project?.conceptionResponsible?.username }}</p>
            <p class="mb-1" *ngIf="project?.conceptionResponsible?.username">Début: {{ project.startConception| date:'yyyy-MM-dd' }}</p>
            <p class="mb-1" *ngIf="project?.conceptionResponsible?.username">Fin: {{ project.endConception| date:'yyyy-MM-dd' }}</p>
            <p class="mb-1" *ngIf="project?.conceptionResponsible?.username">Fin réelle: {{ project.realendConception| date:'yyyy-MM-dd'}}</p>
      </div>
    

</ng-template>
<!---------------------------------------------------------------------------------------------------------->
<ng-template #detailsmetModal>

  <div class="modal-header">
    <h5 class="modal-title">Détails</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body modal-body-centered">
    <p class="mb-1" 
    *ngIf="project?.methodeResponsible?.username">{{ project.methodeComment }}</p>
  <p class="mb-1" >
    Durée: {{ project.methodeDuration }} heures</p>
  <p class="mb-0" 
    *ngIf="project?.methodeResponsible?.username">Pilote: {{ project.methodeResponsible.username }}</p>
  <p class="mb-1" 
    *ngIf="project?.methodeResponsible?.username">Début: {{ project.startMethode| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.methodeResponsible?.username">Fin: {{ project.endMethode| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.methodeResponsible?.username">Fin réelle: {{ project.realendMethode| date:'yyyy-MM-dd' }}</p>
      </div>
    

</ng-template>
<!---------------------------------------------------------------------------------------------->
<ng-template #detailsprodModal>

  <div class="modal-header">
    <h5 class="modal-title">Détails</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body modal-body-centered">
    <p class="mb-1" 
              *ngIf="project?.productionResponsible?.username">{{ project.productionComment }}</p>
            <p class="mb-1"
              >Durée: {{
              project.productionDuration }} heures</p>
            <p class="mb-0" 
              *ngIf="project?.productionResponsible?.username">Pilote: {{ project.productionResponsible.username }}</p>
            <p class="mb-1" 
              *ngIf="project?.productionResponsible?.username">Début: {{ project.startProduction| date:'yyyy-MM-dd' }}</p>
            <p class="mb-1" 
              *ngIf="project?.productionResponsible?.username">Fin: {{ project.endProduction| date:'yyyy-MM-dd' }}</p>
            <p class="mb-1" 
              *ngIf="project?.productionResponsible?.username">Fin réelle: {{ project.realendProduction| date:'yyyy-MM-dd'
              }}</p>
      </div>
    

</ng-template>
<!------------------------------------------------------------------------------------------------------->
<ng-template #detailsfcModal>

  <div class="modal-header">
    <h5 class="modal-title">Détails</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body modal-body-centered">
    <p class="mb-1" 
    *ngIf="project?.finalControlResponsible?.username">{{ project.finalControlComment }}</p>
  <p class="mb-1" >Durée: {{
    project.finalControlDuration }} heures</p>
  <p class="mb-0" 
    *ngIf="project?.finalControlResponsible?.username">Pilote: {{ project.finalControlResponsible.username }}</p>
  <p class="mb-1" 
    *ngIf="project?.finalControlResponsible?.username">Début: {{ project.startFc| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.finalControlResponsible?.username">Fin: {{ project.endFc| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.finalControlResponsible?.username">Fin réelle: {{ project.realendFc| date:'yyyy-MM-dd' }}</p>
      </div>
    

</ng-template>

<!----------------------------------------------------------------------------------------------->
<ng-template #detailsdelModal>

  <div class="modal-header">
    <h5 class="modal-title">Détails</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalRef?.hide()"></button>
  </div>
  <div class="modal-body modal-body-centered">
    <p class="mb-1" 
    *ngIf="project?.deliveryResponsible?.username">{{ project.deliveryComment }}</p>
  <p class="mb-1" >
    Durée: {{ project.deliveryDuration }} heures</p>
  <p class="mb-0" 
    *ngIf="project?.deliveryResponsible?.username">Pilote: {{ project.deliveryResponsible.username }}</p>
  <p class="mb-1" 
    *ngIf="project?.deliveryResponsible?.username">Début: {{ project.startDelivery| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.deliveryResponsible?.username">Fin: {{ project.endDelivery| date:'yyyy-MM-dd' }}</p>
  <p class="mb-1" 
    *ngIf="project?.deliveryResponsible?.username">Fin réelle: {{ project.realendDelivery| date:'yyyy-MM-dd' }}
  </p>
      </div>
    

</ng-template>
