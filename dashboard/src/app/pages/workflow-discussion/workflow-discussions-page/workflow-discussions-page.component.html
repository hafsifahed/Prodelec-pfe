<div class="chat-app-container">
  <!-- Left Panel: Discussion List -->
  <aside class="left-panel" [class.open]="!isMobileView || !selectedDiscussionId">
    <app-discussion-list
      (discussionSelected)="onDiscussionSelected($event)"
      [selectedDiscussionId]="selectedDiscussionId">
    </app-discussion-list>
  </aside>

  <!-- Main Chat Section -->
  <main class="chat-section">
    <ng-container *ngIf="selectedDiscussionId; else emptyState">
      <div class="chat-header">
        <button class="back-button" *ngIf="isMobileView" (click)="closeDiscussionView()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <h3 style="color: white !important;">{{ currentDiscussion?.cdc?.titre || 'Conversation' }}</h3>
        <button class="details-toggle" (click)="toggleDetailsPanel()">
          <i class="bx bx-detail" style="font-size: 1.6rem;"></i>
        </button>
      </div>
      <app-discussion-view [discussionId]="selectedDiscussionId"></app-discussion-view>
    </ng-container>

    <ng-template #emptyState>
      <div class="empty-chat">
        <i class="fas fa-comment-dots"></i>
        <h3>Select a discussion</h3>
        <p>Choose a conversation from the list to view messages.</p>
      </div>
    </ng-template>
  </main>

  <!-- Right Panel: Workflow Details -->
  <aside class="right-panel" [class.open]="detailsOpen">
    <div (click)="toggleDetailsPanel()">
      <i class="fas fa-times"></i>
    </div>
    <app-workflow-details-sidebar [discussion]="currentDiscussion"></app-workflow-details-sidebar>
  </aside>
</div>