<div class="discussion-list">
  <div class="list-header">
    <h2>Discussions</h2>
    <div class="search-box">
      <i class="bx bx-search" style="font-size: 1.2rem;"></i>
      <input 
        type="text" 
        placeholder="Search discussions..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange($event.target.value)"
        (keyup.enter)="onSearch(searchTerm)"
      >
      <button 
        *ngIf="searchTerm" 
        class="clear-search" 
        (click)="clearSearch()"
        title="Clear search"
      >
        <i class="bx bx-x"></i>
      </button>
    </div>
  </div>

  <div class="list-content" (scroll)="onScroll($event)">
    <!-- Indicateur de recherche -->
    <div class="search-info" *ngIf="searchTerm && !isLoading">
      <p *ngIf="discussions.length > 0">
        Found {{totalItems}} discussion(s) for "{{searchTerm}}"
      </p>
      <p *ngIf="discussions.length === 0 && !error">
        No discussions found for "{{searchTerm}}"
      </p>
    </div>

    <div class="error-state" *ngIf="error">
      <i class="fas fa-exclamation-triangle"></i>
      <p>Failed to load discussions.</p>
      <button (click)="loadDiscussions()">Retry</button>
    </div>
    
    <div class="empty-list" *ngIf="!isLoading && !error && discussions.length === 0 && !searchTerm">
      <i class="fas fa-inbox"></i>
      <p>No discussions found.</p>
    </div>

    <div class="discussion-items">
      <div 
        *ngFor="let discussion of discussions"
        class="discussion-item"
        [class.active]="discussion.id === selectedDiscussionId"
        (click)="discussionSelected.emit(discussion.id)"
      >
        <div class="item-avatar">
          <div class="phase-indicator" [ngClass]="discussion.currentPhase"></div>
          <div *ngIf="discussion.unreadCount && !isCurrentUserAuthorOfLastMessage(discussion)" class="unread-badge">
            {{ discussion.unreadCount > 99 ? '99+' : discussion.unreadCount }}
          </div>
        </div>
        
        <div class="item-content">
          <div class="item-header">
            <h4>{{ getDiscussionTitle(discussion) }}</h4>
            <span class="item-time">{{ discussion.createdAt | date:'shortDate' }}</span>
          </div>
          
          <div [class]="getLastMessageClass(discussion)">
            {{ getLastMessagePreview(discussion) }}
            <span *ngIf="isCurrentUserAuthorOfLastMessage(discussion)" class="message-indicator own">
              ✓
            </span>
          </div>
          
          <div class="item-footer">
            <span class="badge" [ngClass]="discussion.currentPhase">
              {{ discussion.currentPhase | uppercase }}
            </span>
            <span *ngIf="isLastMessageUnread(discussion)" class="unread-indicator"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Indicateur de chargement -->
    <div class="load-more-indicator" *ngIf="isLoadingMore">
      <i class="fas fa-spinner fa-spin"></i> Loading more discussions...
    </div>

    <!-- Message quand tout est chargé -->
    <div class="no-more-results" *ngIf="!hasMore && discussions.length > 0">
      <p *ngIf="searchTerm">All search results have been loaded</p>
      <p *ngIf="!searchTerm">All your discussions have been loaded</p>
    </div>
  </div>
</div>